# 06

## 渲染的补充
* ppr: 动态组件的流式渲染
    * 修改config
    * 暴露属性
    * suspense
* 服务端组件
    * 异步的服务端组件要套在suspense里
    * 优点
        * 服务端发出请求, 服务器性能肯定比用户pc更好
        * 渲染后交给客户端, 减少js传输量, 渲染好的内容更好被爬虫检索, 预览效果也更好
        * 缓存在服务端, 减少客户端内存使用
* 客户端组件
    * 通过use client定义, 该组件下方所有子组件都自动变成客户端组件
        * 基于自动转换的特性可以做包装
        * 服务端和客户端组件可以传递数据
        * 不能在客户端组件内直接引用服务端组件
            * 先渲染服务端再渲染客户端, 所以客户端下的服务端没法渲染
                * 服务端先生产内容, 客户端决定摆放位置
            * 可以把服务端组件的jsx向下给客户端组件
                * 实际关联的是服务端组件而非客户端组件
    * 客户端组件不会影响静态渲染
        * 但是渲染的内容只是未携带动态内容的模板
    * 优点
        * 浏览器api
        * 支持交互
    * 基于上述对比, 尽可能使用服务端组件, 只在局部使用客户端组件
* 数据共享
    * 服务端fetch
    * 客户端swr/context

## auth
* 登陆表单
    * 复习一下serverAction/useActionState/抽hook/memo
    * 离程序核心越远拦截越好
* 认证处理
    * 可以把用户信息存db里, 然后把加密后的key返回给浏览器
        * redis 高效+时效性 / Bloom Filter 提高验证效率
        * cookie 自动携带, 浏览器有大小限制
        * jwt 跨域+时效性, 需要自己带
    * 再次访问时进行校验
        * 中间件
        * 组件内根据用户权限做不同处理
            * 组件间共享缓存
        * serveraction/api也可以做校验